# Policy Contract

\
The Fida Policy Contract serves as a central entity within the system. It operates as a contract that is parameterized by a single element, namely `policyId`, which stands as a unique identifier.

Below you can find a definition of its validator function with `PolicyId` as a first parameter.

```haskell
mkFidaContractValidator ::
  PolicyId ->
  FidaContractDatum ->
  FidaContractRedeemer ->
  ScriptContext ->
  Bool
```

Technically `PolicyId` is a wrapper around the currency symbol generated by the Fida Contract Minting Policy. It's important to note that the `policyId` unequivocally dictates Fida Policy Contract validator address.

```haskell
newtype PolicyId = PolicyId CurrencySymbol
```

To ensure the uniqueness of each `policyId`, the Fida Contract Minting Policy (defined with `mkFidaContractMintingPolicy` validator function) is configured with an unspent UTXO (`TxOutRef`) that must be spent during the minting process.&#x20;

```haskell
mkFidaContractMintingPolicy ::
  TxOutRef ->
  () ->
  ScriptContext ->
  Bool
```

The Fida Contract Minting Policy produces two distinct types of tokens:

* The policy token, distinguished by the `POLICY_ID` token name.
* The Fida card token, identified with the `CARD` token name.

These tokens are exclusively minted during the policy creation process and can be considered as non-fungible tokens (NFTs). The first token is utilized to label the UTxO storing the datum (`FidaContractDatum`) that describes the Fida Policy definition. On the other hand, the second token facilitates the creation of multiple Fida Card Tokens, with the quantity determined by a policy parameter. This mechanism serves to distribute shares among investors during the selling process.

```haskell
data FidaContractDatum = FidaContractDatum
  { collateralAmount :: Integer
  , fidaCardValue    :: Integer
  , premiumAmount    :: Integer
  , policyHolder     :: Address
  , policyAuthority  :: PolicyAuthority
  , startDate        :: Maybe POSIXTime
  , paymentIntervals :: Integer
  , contractState    :: FidaContractState
  }
```

When creating a Fida Policy, the broker designates the quantity of Fida Card Tokens to be generated, along with the collateral amount in Ada, which functions as insurance. This information is documented in a FidaContractDatum, directly in the `collateralAmount` field, and indirectly in the `fidaCardValue` (calculated as `collateralAmount / numberOfCards`).

To ensure easy discoverability of the Fida Policy, a beacon token is deployed to a contract address during its creation. The beacon token is minted by a System Minting Policy (`mkSystemIdMintingPolicy`), which is configured with two parameters:

* `SystemGovernance` - representing the public key hash of the authorized wallet permitted to mint tokens.
* `SystemMagic`- serving as the system seed enabling the generation of diverse system families.

```haskell
mkSystemIdMintingPolicy ::
  SystemGovernance ->
  SystemMagic ->
  () ->
  ScriptContext ->
  Bool
  
newtype SystemId = SystemId CurrencySymbol

newtype SystemGovernance = SystemGovernance PubKeyHash
```

The currency symbol, generated by the System Minting Policy and encapsulated with `SystemId`, acts as a system identifier. Multiple Fida systems can operate simultaneously in the same location, with each one distinguished by a unique `SystemId`.

### FidaContractDatum Fields

#### collateralAmount

TODO

#### fidaCardValue

TODO

#### premiumAmount

TODO

#### policyHolder

TODO

#### policyAuthority

```haskell
data PolicyAuthority
  = SingleSign PubKeyHash
  | AtLeastOneSign [PubKeyHash]
  | AllMustSign [PubKeyHash]
  | MajorityMustSign [PubKeyHash]
```

TODO

#### startDate

TODO

#### paymentIntervals

TODO

#### contractState

TODO

```haskell
data FidaContractState = Initialized | OnRisk
```

### Contract actions

TODO

```haskell
data FidaContractRedeemer
  = BuyFidaCard Integer 
  | PayPremium Integer 
  | Activate
```

